<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>JDBC Driver Support for High Availability, Disaster Recovery</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="62de4be6-b027-427d-a7e5-352960e42877" /><meta name="Description" content="This topic discusses Microsoft JDBC Driver for SQL Server support for high-availability, disaster recovery -- AlwaysOn Availability Groups. For more information about AlwaysOn Availability Groups, see SQL Server 2012 Books Online." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">JDBC Driver Support for High Availability, Disaster Recovery</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>This topic discusses Microsoft JDBC Driver for SQL Server support for high-availability, disaster recovery -- AlwaysOn Availability Groups. For more information about AlwaysOn Availability Groups, see SQL Server 2012 Books Online.</p><p>Beginning in version 4.0 of the Microsoft JDBC Driver for SQL Server, you can specify the availability group listener of a (high-availability, disaster-recovery) availability group (AG) in the connection property. If a Microsoft JDBC Driver for SQL Server application is connected to an AlwaysOn database that fails over, the original connection is broken and the application must open a new connection to continue work after the failover.</p><p>If you are not connecting to an availability group listener, and if multiple IP addresses are associated with a server, the Microsoft JDBC Driver for SQL Server attempts to connect to the first IP address. If the Microsoft JDBC Driver for SQL Server cannot establish a connection with first IP address, the connection fails. The Microsoft JDBC Driver for SQL Server will not attempt to connect to any subsequent IP address associated with the server. When connecting to an availability group listener, the Microsoft JDBC Driver for SQL Server attempts to establish connections to all IP addresses in parallel and if a connection attempt succeeds, the driver will discard any pending connection attempts.</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>Increasing connection timeout and implementing connection retry logic will increase the probability that an application will connect to an availability group. Also, because a connection can fail because of an availability group failover, you should implement connection retry logic, retrying a failed connection until it reconnects.</p></div><p>The following <a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">connection properties</a> were added in Microsoft JDBC Driver 4.0 for SQL Server:</p><ul><li><p><span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span></p></li><li><p><span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span></p></li></ul></div><h1 class="heading">Connecting With MultiSubnetFailover</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Always specify <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> when connecting to the availability group listener of a SQL Server 2012 availability group or a SQL Server 2012 Failover Cluster Instance. <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> enables faster failover for all Availability Groups and failover cluster instances in SQL Server 2012 and will significantly reduce failover time for single and multi-subnet AlwaysOn topologies. During a multi-subnet failover, the client will attempt connections in parallel. During a subnet failover, the Microsoft JDBC Driver for SQL Server will aggressively retry the TCP connection.</p><p>The <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property indicates that the application is being deployed in an availability group or Failover Cluster Instance and that the Microsoft JDBC Driver for SQL Server will try to connect to the database on the primary SQL Server instance by trying to connect to all the IP addresses. When <span sdata="langKeyword" value="MultiSubnetFailover=true"><span class="keyword">MultiSubnetFailover=true</span></span> is specified for a connection, the client retries TCP connection attempts faster than the operating system’s default TCP retransmit intervals. This enables faster reconnection after failover of either an AlwaysOn Availability Group or an AlwaysOn Failover Cluster Instance, and is applicable to both single- and multi-subnet Availability Groups and Failover Cluster Instances.</p><p>For more information about connection string keywords in the Microsoft JDBC Driver for SQL Server, see <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Setting the Connection Properties</a></span>.</p><p>Specifying <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> when connecting to something other than an availability group listener or Failover Cluster Instance may result in a negative performance impact, and is not supported.</p><p>If the security manager is not installed, the Java Virtual Machine caches virtual IP addresses (VIPs) for a finite period of time, by default, defined by your JDK implementation and the Java properties networkaddress.cache.ttl and networkaddress.cache.negative.ttl. If the JDK security manager is installed, the Java Virtual Machine will cache VIPs, and will not refresh the cache by default. You should set "time-to-live" (networkaddress.cache.ttl) to one day for the Java Virtual Machine cache. If you don’t change the default value to one day (or so), the old value will not be purged from the Java Virtual Machine cache when a VIP is added or updated. For more information about networkaddress.cache.ttl and networkaddress.cache.negative.ttl, see <a href="http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html">http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html</a>.</p><p>Use the following guidelines to connect to a server in an availability group or Failover Cluster Instance:</p><ul><li><p>The driver will generate an error if the <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> connection property is used in the same connection string as the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property. This reflects the fact that SQL Browser is not used in an availability group. However, if the <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span> connection property is also specified, the driver will ignore <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> and use <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span>.</p></li><li><p>Use the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property when connecting to a single subnet or multi-subnet, it will improve performance for both.</p></li><li><p>To connect to an availability group, specify the availability group listener of the availability group as the server in your connection string. For example, jdbc:sqlserver://VNN1.</p></li><li><p>Connecting to a SQL Server instance configured with more than 64 IP addresses will cause a connection failure.</p></li><li><p>Behavior of an application that uses the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property is not affected based on the type of authentication: SQL Server Authentication, Kerberos Authentication, or Windows Authentication.</p></li><li><p>Increase the value of <span sdata="langKeyword" value="loginTimeout"><span class="keyword">loginTimeout</span></span> to accommodate for failover time and reduce application connection retry attempts.</p></li><li><p>Distributed transactions are not supported.</p></li></ul><p>If read-only routing is not in effect, connecting to a secondary replica location in an availability group will fail in the following situations:</p><ol><li><p>If the secondary replica location is not configured to accept connections.</p></li><li><p>If an application uses <span sdata="langKeyword" value="applicationIntent=ReadWrite"><span class="keyword">applicationIntent=ReadWrite</span></span> (discussed below) and the secondary replica location is configured for read-only access.</p></li></ol><p>A connection will fail if a primary replica is configured to reject read-only workloads and the connection string contains <span sdata="langKeyword" value="ApplicationIntent=ReadOnly"><span class="keyword">ApplicationIntent=ReadOnly</span></span>.</p></div><h1 class="heading">Upgrading to Use Multi-Subnet Clusters from Database Mirroring</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>If you upgrade a Microsoft JDBC Driver for SQL Server application that currently uses database mirroring to a multi-subnet scenario, you should remove the <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> connection property and replace it with <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> set to <span sdata="langKeyword" value="true"><span class="keyword">true</span></span> and replace the server name in the connection string with a availability group listener. If a connection string uses <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> and <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span>, the driver will generate an error. However, if a connection string uses <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> and <span sdata="langKeyword" value="multiSubnetFailover=false"><span class="keyword">multiSubnetFailover=false</span></span> (or <span sdata="langKeyword" value="ApplicationIntent=ReadWrite"><span class="keyword">ApplicationIntent=ReadWrite</span></span>), the application will use database mirroring.</p><p>The driver will return an error if database mirroring is used on the primary database in the AG, and if <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> is used in the connection string that connects to a primary database instead of to an availability group listener.</p></div><h1 class="heading">Specifying Application Intent</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>When <span sdata="langKeyword" value="applicationIntent=ReadOnly"><span class="keyword">applicationIntent=ReadOnly</span></span>, the client requests a read-only workload when connecting to an AlwaysOn enabled database. The server will enforce the intent at connection time and during a USE database statement but only to an AlwaysOn enabled database.</p><p>The <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> keyword does not work with legacy, read-only databases.</p><p>A database can allow or disallow read workloads on the targeted AlwaysOn database. (This is done with the <span sdata="langKeyword" value="ALLOW_CONNECTIONS"><span class="keyword">ALLOW_CONNECTIONS</span></span> clause of the <span sdata="langKeyword" value="PRIMARY_ROLE"><span class="keyword">PRIMARY_ROLE</span></span> and <span sdata="langKeyword" value="SECONDARY_ROLE"><span class="keyword">SECONDARY_ROLE</span></span> Transact-SQL statements.)</p><p>The <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> keyword is used to enable read-only routing.</p></div><h1 class="heading">Read-Only Routing</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>Read-only routing is a feature that can ensure the availability of a read-only replica of a database. To enable read-only routing:</p><ol><li><p>You must connect to an AlwaysOn Availability Group availability group listener.</p></li><li><p>The <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> connection string keyword must be set to <span sdata="langKeyword" value="ReadOnly"><span class="keyword">ReadOnly</span></span>.</p></li><li><p> The Availability Group must be configured by the database administrator to enable read-only routing.</p></li></ol><p>It is possible that multiple connections using read-only routing will not all connect to the same read-only replica. Changes in database synchronization or changes in the server's routing configuration can result in client connections to different read-only replicas. To ensure that all read-only requests connect to the same read-only replica, do not pass an availability group listener or virtual IP address to the <span sdata="langKeyword" value="serverName"><span class="keyword">serverName</span></span> connection string keyword. Instead, specify the name of the read-only instance.</p><p>Read-only routing may take longer than connecting to the primary because read-only routing first connects to the primary and then looks for the best available readable secondary. Because of this, you should increase your login timeout.</p></div><h1 class="heading">New Methods Supporting multiSubnetFailover and applicationIntent</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>The following methods give you programmatic access to the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> and <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> connection string keywords:</p><ul><li><p><a href="19411e6c-c456-4533-8252-54569a2a6b1f.htm">SQLServerDataSource.getApplicationIntent</a></p></li><li><p><a href="e164c8ac-a0ae-4638-affb-ed454e7c0708.htm">SQLServerDataSource.setApplicationIntent</a></p></li><li><p><a href="1e8cb175-5f4c-4208-b4f5-3646990a30e3.htm">SQLServerDataSource.getMultiSubnetFailover</a></p></li><li><p><a href="7ffd282d-c2f6-4d1b-a7a6-859d18b388aa.htm">SQLServerDataSource.setMultiSubnetFailover</a></p></li><li><p><a href="b5eaad8a-31ef-44ac-af11-d5caa13ac3e2.htm">SQLServerDriver.getPropertyInfo</a></p></li></ul><p>The <span sdata="langKeyword" value="getMultiSubnetFailover"><span class="keyword">getMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="setMultiSubnetFailover"><span class="keyword">setMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="getApplicationIntent"><span class="keyword">getApplicationIntent</span></span>, and <span sdata="langKeyword" value="setApplicationIntent"><span class="keyword">setApplicationIntent</span></span> methods are also added to <span sdata="link"><a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">SQLServerDataSource Class</a></span>, <span sdata="link"><a href="b00e5a90-2af7-4d04-8ef8-256183777dcf.htm">SQLServerConnectionPoolDataSource Class</a></span>, and <span sdata="link"><a href="95fc7b07-2498-4a7e-8f7f-ee0d86b598b4.htm">SQLServerXADataSource Class</a></span>.</p></div><h1 class="heading">SSL Certificate Validation</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>An availability group consists of multiple physical servers. Microsoft JDBC Driver 4.0 for SQL Server added support for <span sdata="langKeyword" value="Subject Alternate Name"><span class="keyword">Subject Alternate Name</span></span> in SSL certificates so multiple hosts can be associated with the same certificate. For more information on SSL, see <span sdata="link"><a href="073f3b9e-8edd-4815-88ea-de0655d0325e.htm">Understanding SSL Support</a></span>.</p></div><span id="seeAlsoSpan"><h1 class="heading">See Also</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Setting the Connection Properties</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Connecting to SQL Server with the JDBC Driver</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Send <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','01.00.12024.10000','%0\dThank%20you%20for%20your%20feedback.%20The%20developer%20writing%20teams%20use%20your%20feedback%20to%20improve%20documentation.%20While%20we%20are%20reviewing%20your%20feedback,%20we%20may%20send%20you%20e-mail%20to%20ask%20for%20clarification%20or%20feedback%20on%20a%20solution.%20We%20do%20not%20use%20your%20e-mail%20address%20for%20any%20other%20purpose%20and%20we%20delete%20it%20after%20we%20finish%20our%20review.%0\AFor%20further%20information%20about%20the%20privacy%20policies%20of%20Microsoft,%20please%20see%20http://privacy.microsoft.com/en-us/default.aspx.%0\A%0\d','Customer%20Feedback');">feedback</a> on this topic to Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft.  All rights reserved.</a></p></span></div></div></body></html>